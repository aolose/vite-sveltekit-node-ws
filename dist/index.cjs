"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const m=require("http"),b=require("https"),v=()=>c?global.httpSrv:S,p=e=>{e&&(c?global.httpSrv=e:S=e)};let c=!1,S,i,a,o;const k=e=>{const r=e.on;e.on=function(...n){n[0]==="request"?(r.call(this,"request",function(t,l){g(t.url)||n[1].call(this,t,l)}),o=()=>{e.on=r}):r.call(this,...n)}},g=e=>{if(!(!e||!a))return a(new URL(e,"http://a.a").pathname)},u=[],f=e=>{const r=e.createServer;u.push([r,e]),e.createServer=function(...n){u.forEach(([t,l])=>{l.createServer=t});const s=r.call(this,...n);return p(s),k(s),d(),s}},d=()=>{const e=v();e&&i&&setTimeout(()=>{o==null||o(),i(e)})},T=()=>{v()||(f(m),f(b))},h=e=>{p(e.httpServer)};function H({hmrPort:e,buildModification:r=`import {handle} from 'vite-sveltekit-node-ws';
handle();`,global:n=!1}={}){return c=n,{name:"vite-sveltekit-node-ws",config(s){if(e===!1)return;const t=s.server=s.server||{};(t.hmr===!0||!t.hmr)&&(t.hmr={}),t.hmr.port=e||(t.port||57777)+1},async transform(s,t){if(t.endsWith("@sveltejs/kit/src/runtime/server/index.js")){const l=r;return{code:s.replace(/([\s\S]*import.*?from.*?(['"]).*?\2;\n)/,`$1${l}`)}}return null},configurePreviewServer:h,configureServer:h}}const P=({callback:e,skip:r,global:n=!1})=>{c=n,a=r,i=e,d()};exports.default=H;exports.handle=T;exports.useServer=P;
